import { useEffect, useState } from 'react'
import { Aproach } from '../Components/aproach/Aproach'
import { Header } from '../Components/header/Header'
import { ImageOfDay } from '../Components/imageDay/ImageOfDay'
import { api } from '../services/api'
import { DataMissionManifest, DataRover, ImageDay, NearbyType, RoversType } from '../services/types'

import Head from 'next/head'
import Image from 'next/image'
import { Division } from '../Components/Divisor'
import { Foot } from '../Components/foot/Foot'
import { Rovers } from '../Components/rovers/Rovers'


export default function Home() {

   const [ rovers, setRovers ] = useState<RoversType[]>([])

   const [ dataRover, setDataRover ] = useState<DataRover[]>([])
   
   const [ dataManifestHover, setDataManifestHover ] = useState<DataMissionManifest>({} as DataMissionManifest)
   
   const [ imageDay, setImageDay ] = useState<ImageDay>({} as ImageDay)
   
   const [ nearbyObjects, setNearbyObjects ] = useState<NearbyType[]>([])

   useEffect(() => {
      getMissionManifest()
      getImageDay()
      getRovers()
      getNearbyObjects()
   }, [])

   async function getRovers() {
      const response = await api.post(`/api/nasa`, {
         headers: {
         state: 'hovers'
         }
      })

      setRovers(response.data.data)
   }

   async function getMissionManifest() {
      const response = await api.post(`/api/nasa`, {
         headers: {
         state: 'mission_manifest'
         }
      })

      setDataManifestHover(response.data.data)
   }

   async function getDataHover() {
      const response = await api.post(`/api/nasa`, {
         headers: {
         state: 'data_hover',
         maxDate: dataManifestHover.max_date
         }
      })

      setDataRover(response.data.data)
   }

   async function getImageDay() {
      const response = await api.post(`/api/nasa`, {
         headers: {
         state: 'image_day'
         }
      })

      setImageDay(response.data.data)
   }

   async function getNearbyObjects() {
      const response = await api.post(`/api/nasa`, {
         headers: {
         state: 'nearby'
         }
      })
      setNearbyObjects(response.data.data)
   }

   return (
      <>
      <Head>
         <title>Home | Travel Space</title>
         <meta name="description" content="Generated by create next app" />
         <meta name="viewport" content="width=device-width, initial-scale=1" />
         <link rel="icon" href="/favicon.ico" />
      </Head>

      <main className='flex flex-col gap-24 items-center'>

         <Header/>

         <Division/>

         <ImageOfDay imageDay={imageDay}/>

         <Division/>

         <section className='flex flex-col items-center gap-24 p-4  sm:p-10 font-semibold'>

            <Rovers rovers={rovers}/>

            <Division/>

            <Aproach nearbyObjects={nearbyObjects}/>    

            <Division/>       

            <button onClick={() => getDataHover()} className='p-4 px-10 bg-blue-600 text-white '>
               Request
            </button>

            <div className='grid grid-cols-2 gap-20'>
            { dataRover.map((val) => (
               <div key={val.id} className=''>
                  <Image alt='' src={val.img_src} width={600} height={300} className={'max-w-[500px] max-h-[500px] rounded-xl shadow-boxPurple'}/>
               
                  <div className='flex justify-between items-center p-6 text-white bg-blue-800 rounded-2xl -mt-2'>
                     <text>{val.earth_date}</text>
                     <text>{val.rover.name}</text>
                     <text>{val.camera.full_name}</text>
                  </div>
               </div>
               ))
            }
            </div>
         </section>

         <Division/>

         <Foot/>
         
      </main>
      </>
   )
}
